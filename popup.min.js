document.addEventListener("DOMContentLoaded",(()=>{function e(){document.getElementById("subscription-section").innerHTML='\n      <div style="display: flex; justify-content: space-between; align-items: center;">\n        <p style="color: green; font-weight: bold;">Subscription Active - Paid For!</p>\n        <button id="deregisterSubscription" style="background-color: #FB6107; color: white;">Deregister</button>\n      </div>\n    ',document.getElementById("deregisterSubscription").addEventListener("click",(()=>{chrome.storage.local.remove(["subscriptionId","subscriptionActive"],(()=>{alert("Subscription Unlinked."),t(),chrome.runtime.sendMessage({action:"checkSubscriptionStatus"}),document.getElementById("subscription-section").innerHTML='\n      <h3>Enter Activation Code:</h3>\n      <input type="text" id="subscriptionId" placeholder="Activation Code">\n      <button id="saveSubscriptionId">Activate</button>\n    '}))}))}function t(){const e=document.getElementById("captureQuestion"),t=document.getElementById("stealthSwitch");e.disabled=!0,e.classList.add("disabled"),e.innerHTML="&#128274; Capture A Question",e.style.backgroundColor="#ccc",t.disabled=!0,document.querySelector(".stealth-mode-label").innerHTML="&#128274; Stealth Mode"}function n(){const e=document.getElementById("captureQuestion"),t=document.getElementById("stealthSwitch");e.disabled=!1,e.classList.remove("disabled"),e.innerHTML="&#128248; Capture A Question",e.style.backgroundColor="#6FE89A",t.disabled=!1,document.querySelector(".stealth-mode-label").innerHTML="&#129399; Stealth Mode"}chrome.storage.local.get(["response","subscriptionActive","subscriptionId","stealthMode","stealthModeExpiry"],(o=>{document.getElementById("answer").textContent=o.response||"No response yet.";const s=Date.now();o.stealthMode&&o.stealthModeExpiry&&s>o.stealthModeExpiry?(chrome.storage.local.set({stealthMode:!0}),document.getElementById("stealthSwitch").checked=!0):document.getElementById("stealthSwitch").checked=o.stealthMode||!0,o.subscriptionActive?(e(),n()):t()})),chrome.runtime.onMessage.addListener((e=>{"updatePopupResponse"===e.action&&("Not defined"===e.response?document.getElementById("answer").textContent="Thinking...":document.getElementById("answer").textContent=e.response,chrome.storage.local.set({response:e.response}))})),document.getElementById("captureQuestion").addEventListener("click",(()=>{chrome.runtime.sendMessage({action:"triggerSelection"},(e=>{chrome.runtime.lastError})),window.close()})),document.getElementById("stealthSwitch").addEventListener("change",(e=>{const t=e.target.checked;if(chrome.storage.local.set({stealthMode:t}),t){const e=Date.now()+72e5;chrome.storage.local.set({stealthModeExpiry:e}),setTimeout((()=>{chrome.storage.local.set({stealthMode:!1},(()=>{document.getElementById("stealthSwitch").checked=!1}))}),72e5)}else chrome.storage.local.remove("stealthModeExpiry")})),document.getElementById("saveSubscriptionId").addEventListener("click",(()=>{const t=document.getElementById("subscriptionId").value;t?async function(e){try{const t=await fetch(`https://rightclickpay.atrus.uk/check-subscription?subscriptionId=${e}`,{method:"GET",headers:{"Content-Type":"application/json"}}),n=await t.json();return"active"===n.status&&n.paid}catch(e){return console.error("Error fetching subscription status from API:",e),!1}}(t).then((o=>{o?chrome.storage.local.set({subscriptionId:t,subscriptionActive:!0},(()=>{alert("RightClick has been Activated!"),e(),n(),chrome.runtime.sendMessage({action:"checkSubscriptionStatus"})})):alert("Invalid Activation Code.")})):alert("Please enter your Activation Code.")})),chrome.runtime.onMessage.addListener((e=>{"updatePopupResponse"===e.action&&(document.getElementById("answer").textContent=e.response,chrome.storage.local.set({response:e.response}))}))})),document.getElementById("learnMoreLink").addEventListener("click",(function(){chrome.tabs.create({url:"https://www.notion.so/Stealth-Mode-107069fffad380eea35dc4af8e1ad5e5"})})),document.getElementById("learnRC").addEventListener("click",(function(){chrome.tabs.create({url:"https://www.notion.so/How-To-Use-10c069fffad380c29326dde2b3811397"})}));